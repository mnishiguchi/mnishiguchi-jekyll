#!/usr/bin/env ruby
# frozen_string_literal: true

require 'rubygems'
require 'thor'
require 'fileutils'

class Clean < Thor
  # https://github.com/erikhuda/thor/wiki/Making-An-Executable
  def self.exit_on_failure?
    true
  end

  # https://github.com/himanoa/touch_erb/pull/3/files
  default_task :all

  desc 'all', 'Remove all build outputs'
  def all
    webpack_outputs
    jekyll_outputs
  end

  desc 'webpack_outputs', 'Remove files that is generated by Webpack'
  def webpack_outputs
    file_list = Dir.glob('assets/{workbox*,sw*}') |
                Dir.glob('assets/images/vendor') |
                Dir.glob('assets/main-bundle.{js,css}')

    if file_list.empty?
      puts('No Webpack-generated files found')
      return
    end

    if FileUtils.rm_rf(file_list)
      puts 'Deleted files generated by Webpack'
      file_list.sort.each { |file| puts "  #{file}" }
    else
      puts "Error deleting files: #{file_list}"
    end
  end

  desc 'jekyll_outputs', 'Remove files that is generated by Jekyll'
  def jekyll_outputs
    puts `jekyll clean`
  end
end

Clean.start(ARGV)
